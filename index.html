<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ChatOck Tools ‚Äî Game Builder</title>
  <meta name="description" content="Describe your TikTok Live game idea, then build staged files: index.html ‚Üí style.css ‚Üí game.js." />

  <style>
    :root{
      --bg0:#0b0b0c;
      --bg1:#121214;

      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.10);

      --text:#ffffff;
      --muted: rgba(255,255,255,.72);

      --orange:#ff7a18;
      --orange2:#ffb154;

      --good:#2ee59d;
      --bad:#ff4d4d;

      --shadow: 0 18px 55px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.08);
      --r: 18px;
      --r2: 14px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 30% -10%, rgba(255,122,24,.22), transparent 60%),
        radial-gradient(900px 500px at 80% 0%, rgba(255,177,84,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100svh;
    }
    a{color:inherit; text-decoration:none}

    .wrap{max-width:1060px; margin:0 auto; padding:18px 16px 30px}
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 0 16px;
    }
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:40px; height:40px; border-radius:14px;
      background:
        radial-gradient(14px 14px at 28% 30%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, rgba(255,122,24,.95), rgba(255,177,84,.8));
      box-shadow: 0 12px 34px rgba(255,122,24,.18);
      position:relative; overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,.18), transparent 55%);
      transform: rotate(14deg);
    }
    .brand h1{margin:0; font-size:16px; letter-spacing:.2px; line-height:1.1}
    .brand p{margin:2px 0 0; font-size:12px; color:var(--muted)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      font-weight:800;
      letter-spacing:.2px;
      transition: transform .12s ease, border .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.25)}
    .btn:active{transform: translateY(0px)}
    .btn[disabled]{opacity:.45; cursor:not-allowed; transform:none !important}
    .btn.primary{
      border-color: rgba(255,122,24,.55);
      background: linear-gradient(135deg, rgba(255,122,24,.95), rgba(255,177,84,.70));
      color:#120a02;
      box-shadow: 0 12px 36px rgba(255,122,24,.18);
    }
    .btn.primary:hover{border-color: rgba(255,122,24,.9)}
    .btn.ghost{
      background: rgba(0,0,0,.22);
      border-color: rgba(255,255,255,.14);
    }

    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color:rgba(255,255,255,.82);
    }

    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      align-items:start;
      margin-top:6px;
    }
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .hd .title{font-weight:900; letter-spacing:.2px; font-size:13px; margin:0}
    .hd .sub{margin:5px 0 0; font-size:12px; color:var(--muted); line-height:1.35}
    .bd{padding:14px}

    .field{display:grid; gap:6px; margin-bottom:10px}
    .label{
      font-size:12px;
      color:rgba(255,255,255,.86);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .muted{color:var(--muted)}
    .input, textarea{
      width:100%;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.28);
      color:var(--text);
      outline:none;
      transition: border .15s ease, transform .15s ease;
      font-size:14px;
    }
    textarea{min-height:150px; resize:vertical; line-height:1.35}
    .input:focus, textarea:focus{
      border-color: rgba(255,122,24,.65);
      box-shadow: 0 0 0 3px rgba(255,122,24,.18);
    }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .divider{height:1px; background: rgba(255,255,255,.10); margin:12px 0}

    .miniHelp{
      font-size:12px;
      color:rgba(255,255,255,.72);
      line-height:1.45;
      margin:0;
    }
    .bullets{
      margin:10px 0 0;
      padding-left:18px;
      color:rgba(255,255,255,.72);
      font-size:12px;
      line-height:1.5;
    }
    .bullets b{color:rgba(255,255,255,.92)}

    /* Ad placeholders */
    .adSlot{
      border-radius: var(--r2);
      border: 1px dashed rgba(255,255,255,.20);
      background: rgba(0,0,0,.18);
      padding:12px;
      min-height: 86px;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      color:rgba(255,255,255,.58);
      font-size:12px;
      line-height:1.35;
    }
    .adBig{min-height:140px}

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      max-width: 92vw;
      width: 720px;
      background: rgba(0,0,0,.78);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      border-radius: 16px;
      box-shadow: 0 24px 70px rgba(0,0,0,.65);
      padding: 10px 12px;
      display:none;
      z-index:9999;
    }
    .toast.show{display:block}
    .toast .r{display:flex; align-items:flex-start; justify-content:space-between; gap:12px}
    .toast .msg{font-size:13px; line-height:1.35}
    .toast .x{
      width:28px; height:28px; border-radius: 12px;
      display:grid; place-items:center;
      cursor:pointer;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
    }

    footer{
      margin-top:16px;
      padding:14px 0 0;
      color:rgba(255,255,255,.60);
      font-size:12px;
    }
    footer .frow{
      display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top:14px;
    }
    footer .links{display:flex; gap:12px; flex-wrap:wrap}
    footer .links a{
      opacity:.85;
      border-bottom:1px dashed rgba(255,255,255,.22);
    }
    footer .links a:hover{opacity:1}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ChatOck Tools</h1>
          <p>Describe your game ‚Üí open the builder</p>
        </div>
      </div>

      <div class="row">
        <a class="btn ghost" href="builder.html">Open Builder</a>
      </div>
    </header>

    <!-- Top ad placeholder -->
    <div class="card" style="margin-bottom:14px">
      <div class="bd">
        <div class="adSlot">
          <div>
            <b>Ad Placeholder (Header Banner)</b><br />
            We‚Äôll wire this up later (AdSense / other provider).
          </div>
        </div>
      </div>
    </div>

    <div class="hero">
      <!-- LEFT: prompt -->
      <section class="card">
        <div class="hd">
          <div>
            <p class="title">Start here</p>
            <p class="sub">Type your idea. Keep it short. Then we‚Äôll open the staged builder.</p>
          </div>
          <div class="row">
            <span id="micChip" class="chip" style="display:none">Listening‚Ä¶</span>
            <button class="btn ghost" id="btnMic" type="button">üéôÔ∏è Talk</button>
          </div>
        </div>

        <div class="bd">
          <div class="field">
            <div class="label">
              <span>Game idea prompt</span>
              <span class="muted">Tell what viewers do</span>
            </div>
            <textarea id="idea" placeholder="Example: ‚ÄúAsteroid Arena: a neon ship dodges asteroids. Chat spawns asteroids, likes add shields, gifts trigger a laser blast. Survive 60 seconds to win.‚Äù"></textarea>
          </div>

          <div class="row">
            <button class="btn primary" id="btnGo" type="button">Generate Game</button>
            <span class="chip">No preview here (builder exports files)</span>
          </div>

          <div class="divider"></div>

          <p class="miniHelp">
            What to include (fast):
          </p>
          <ul class="bullets">
            <li><b>Theme / vibe:</b> neon, retro, cute, gritty</li>
            <li><b>On-screen action:</b> ship dodges asteroids, racers, trivia duel, etc.</li>
            <li><b>Chat controls:</b> commands, votes, joining</li>
            <li><b>Likes:</b> fuel / shield / bonus</li>
            <li><b>Gifts:</b> power-ups / attacks / boss spawn</li>
            <li><b>Win condition:</b> survive time, score goal, last player, etc.</li>
          </ul>
        </div>
      </section>

      <!-- RIGHT: simple explanation + ad placeholder -->
      <aside class="card">
        <div class="hd">
          <div>
            <p class="title">What happens next?</p>
            <p class="sub">You‚Äôll build files in stages (HTML ‚Üí CSS ‚Üí JS) and copy them into your preview site.</p>
          </div>
        </div>
        <div class="bd">
          <div class="adSlot adBig">
            <div>
              <b>Ad Placeholder (Sidebar)</b><br />
              Optional slot for later monetization.
            </div>
          </div>

          <div class="divider"></div>

          <p class="miniHelp" style="margin-bottom:8px">
            Staged output:
          </p>
          <ul class="bullets" style="margin-top:0">
            <li><b>index.html</b> ‚Äî game layout + setup overlay</li>
            <li><b>style.css</b> ‚Äî theme + UI polish</li>
            <li><b>game.js</b> ‚Äî TikTok events + gameplay logic</li>
          </ul>

          <div class="divider"></div>

          <p class="miniHelp">
            You can refine the prompt afterward to get more ‚Äúreal game action‚Äù
            (like your asteroid movement / collisions / powerups).
          </p>
        </div>
      </aside>
    </div>

    <footer>
      <div class="frow">
        <div>¬© <span id="year"></span> ChatOck Tools</div>
        <div class="links">
          <a href="#" id="linkPrivacy">Privacy (placeholder)</a>
          <a href="#" id="linkTerms">Terms (placeholder)</a>
          <a href="#" id="linkSupport">Support (placeholder)</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <div class="r">
      <div id="toastMsg" class="msg"></div>
      <div id="toastX" class="x" title="Close">‚úï</div>
    </div>
  </div>

  <script>
    // This key MUST match builder.html so it picks up the prompt automatically.
    const LS_KEY = "chattok_builder_state_v2";

    const el = {
      idea: document.getElementById("idea"),
      btnGo: document.getElementById("btnGo"),
      btnMic: document.getElementById("btnMic"),
      micChip: document.getElementById("micChip"),
      year: document.getElementById("year"),
      toast: document.getElementById("toast"),
      toastMsg: document.getElementById("toastMsg"),
      toastX: document.getElementById("toastX"),
      linkPrivacy: document.getElementById("linkPrivacy"),
      linkTerms: document.getElementById("linkTerms"),
      linkSupport: document.getElementById("linkSupport")
    };

    el.year.textContent = new Date().getFullYear();

    function showToast(msg, ms=4200){
      el.toastMsg.textContent = msg;
      el.toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> el.toast.classList.remove("show"), ms);
    }
    el.toastX.addEventListener("click", ()=> el.toast.classList.remove("show"));

    function placeholderLink(name){
      showToast(`${name} page placeholder ‚Äî we‚Äôll build it later.`, 3500);
    }
    el.linkPrivacy.addEventListener("click", (e)=>{ e.preventDefault(); placeholderLink("Privacy"); });
    el.linkTerms.addEventListener("click", (e)=>{ e.preventDefault(); placeholderLink("Terms"); });
    el.linkSupport.addEventListener("click", (e)=>{ e.preventDefault(); placeholderLink("Support"); });

    // Restore last prompt if present
    (function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const s = JSON.parse(raw);
        if(typeof s.idea === "string" && s.idea.trim()){
          el.idea.value = s.idea.trim();
        }
      }catch{}
    })();

    function writePromptIntoBuilderState(){
      const idea = (el.idea.value || "").trim();
      if(!idea) throw new Error("Type a short game idea first.");

      // Minimal snapshot builder.html understands
      const snapshot = {
        apiUrl: "https://chattok-builder-api.onrender.com",
        templateId: "boss",
        remainingEdits: 3,
        context: { spec: null, templateId: "boss" },
        files: { "index.html": "", "style.css": "", "game.js": "" },
        theme: {
          primary: "#ff7a18",
          secondary: "#ffb154",
          background: "#0b0b0c"
        },
        idea
      };

      localStorage.setItem(LS_KEY, JSON.stringify(snapshot));
    }

    el.btnGo.addEventListener("click", ()=>{
      try{
        writePromptIntoBuilderState();
        // Go to staged builder
        window.location.href = "builder.html";
      }catch(e){
        showToast(e.message, 5200);
      }
    });

    // Speech-to-text (Web Speech API)
    let rec = null;
    let isListening = false;

    function supportsSpeech(){
      return ("webkitSpeechRecognition" in window) || ("SpeechRecognition" in window);
    }

    function startSpeech(){
      if(!supportsSpeech()){
        showToast("Speech-to-text not supported in this browser.", 5200);
        return;
      }
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      rec = new SR();
      rec.lang = "en-US";
      rec.interimResults = true;
      rec.continuous = true;

      let finalText = "";

      rec.onstart = () => {
        isListening = true;
        el.micChip.style.display = "inline-flex";
        el.btnMic.textContent = "‚èπ Stop";
      };
      rec.onend = () => {
        isListening = false;
        el.micChip.style.display = "none";
        el.btnMic.textContent = "üéôÔ∏è Talk";
      };
      rec.onerror = () => {
        showToast("Mic error. Check permissions.", 5200);
      };
      rec.onresult = (e) => {
        let interim = "";
        for(let i = e.resultIndex; i < e.results.length; i++){
          const t = e.results[i][0].transcript;
          if(e.results[i].isFinal) finalText += t + " ";
          else interim += t;
        }
        const base = el.idea.value.replace(/\s*\[listening\:\s[\s\S]*\]$/,"");
        const preview = interim ? ` [listening: ${interim.trim()}]` : "";
        el.idea.value = (base + " " + finalText).trim() + preview;
      };

      rec.start();
    }

    function stopSpeech(){
      try{ rec && rec.stop(); }catch{}
    }

    el.btnMic.addEventListener("click", ()=>{
      if(isListening) stopSpeech();
      else startSpeech();
    });

    el.idea.addEventListener("focus", ()=>{
      el.idea.value = el.idea.value.replace(/\s*\[listening\:\s[\s\S]*\]$/,"").trim();
    });

    if(!supportsSpeech()){
      el.btnMic.disabled = true;
      el.btnMic.title = "Speech-to-text not supported in this browser.";
    }
  </script>
</body>
</html>
