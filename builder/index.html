<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ChatTokApps • Game Builder</title>
  <link rel="stylesheet" href="app.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoDot" aria-hidden="true"></div>
      <div class="brandText">
        <div class="brandTitle">ChatTokApps • Game Builder</div>
        <div class="brandSub">Spec → HTML → CSS → game.js → Edit (3×) • Live preview included</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnLoadRoutes" class="btn ghost" type="button">Load Routes</button>
      <button id="btnPing" class="btn ghost" type="button">Ping API</button>
      <button id="btnReset" class="btn ghost" type="button">Reset</button>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- LEFT: Builder steps -->
      <section class="card">
        <div class="headRow">
          <div>
            <div class="h2">Build a TikTok LIVE Interactive Game</div>
            <div class="muted small">API: <span id="apiLabel" class="mono"></span></div>
          </div>
          <div class="stepPills" aria-label="Steps">
            <div class="pillStep" id="pillS1">Active</div>
            <div class="pillStep off" id="pillS2">Locked</div>
            <div class="pillStep off" id="pillS3">Locked</div>
            <div class="pillStep off" id="pillS4">Locked</div>
          </div>
        </div>

        <div class="statusBox">
          <div class="statusLine">
            <span class="muted">Status:</span>
            <strong id="statusText">Not checked</strong>
          </div>
          <div class="statusLine">
            <span class="muted">Activity:</span>
            <span id="buildStatus" class="mono">Idle</span>
          </div>
          <div class="statusLine">
            <span class="muted">requestId:</span>
            <span id="reqId" class="mono">—</span>
          </div>
        </div>

        <details class="advanced" id="advApi">
          <summary>Advanced API settings (rarely needed)</summary>
          <div class="advInner">
            <div class="fieldRow">
              <div class="field">
                <label class="label" for="apiBase">Render API Base URL</label>
                <input id="apiBase" class="input mono" type="text" value="" spellcheck="false" />
                <div class="hint">Default: https://chattok-builder-api.onrender.com</div>
              </div>
              <div class="field">
                <label class="label" for="pingPath">Ping Endpoint</label>
                <input id="pingPath" class="input mono" type="text" value="/api/ping" spellcheck="false" />
                <div class="hint">Usually <span class="mono">/api/ping</span></div>
              </div>
            </div>

            <div class="fieldRow">
              <div class="field">
                <label class="label" for="routesPath">Routes Endpoint</label>
                <input id="routesPath" class="input mono" type="text" value="/api/routes" spellcheck="false" />
              </div>
              <div class="field">
                <label class="label" for="specPath">Spec Endpoint</label>
                <input id="specPath" class="input mono" type="text" value="/api/plan" spellcheck="false" />
              </div>
            </div>

            <div class="fieldRow">
              <div class="field">
                <label class="label" for="buildPath">Build Endpoint</label>
                <input id="buildPath" class="input mono" type="text" value="/api/build" spellcheck="false" />
              </div>
              <div class="field">
                <label class="label" for="editPath">Edit Endpoint</label>
                <input id="editPath" class="input mono" type="text" value="/api/edit" spellcheck="false" />
              </div>
            </div>

            <div class="actions">
              <button id="btnSaveApi" class="btn" type="button">Save API Settings</button>
            </div>

            <div class="hr"></div>
            <div class="field">
              <label class="label">Detected routes</label>
              <pre id="routesOut" class="code" style="min-height: 92px">(Click “Load Routes” in the top-right)</pre>
            </div>
          </div>
        </details>

        <div id="warn" class="warn hidden"></div>

        <!-- STEP 1 -->
        <section class="step">
          <div class="stepTitle">Step 1 • Prompt + Theme</div>

          <div class="field">
            <label class="label" for="prompt">Detailed prompt</label>
            <textarea id="prompt" class="textarea" rows="7" placeholder="Describe the game, chat controls, host controls, scoring, rounds, sounds, visuals...

Example: A space runner where chat spawns obstacles with their profile picture, gifts create boss obstacles, likes give shields, and follows grant bonus points."></textarea>
            <div class="hint">Tip: mention the exact chat keywords you want, plus what gifts/likes/follows/shares do.</div>
          </div>

          <div class="hr"></div>
          <div class="h3">Theme Colors</div>

          <div class="colors">
            <div class="colorRow">
              <label for="cPrimary">Primary</label>
              <input id="cPrimary" type="color" value="#ff0050" />
              <input id="tPrimary" class="input mono" type="text" value="#ff0050" maxlength="7" />
            </div>

            <div class="colorRow">
              <label for="cSecondary">Secondary</label>
              <input id="cSecondary" type="color" value="#00f2ea" />
              <input id="tSecondary" class="input mono" type="text" value="#00f2ea" maxlength="7" />
            </div>

            <div class="colorRow">
              <label for="cBg">Background</label>
              <input id="cBg" type="color" value="#050b17" />
              <input id="tBg" class="input mono" type="text" value="#050b17" maxlength="7" />
            </div>

            <div class="colorRow">
              <label for="cSurface">Surface</label>
              <input id="cSurface" type="color" value="#0b1632" />
              <input id="tSurface" class="input mono" type="text" value="#0b1632" maxlength="7" />
            </div>

            <div class="colorRow">
              <label for="cText">Text</label>
              <input id="cText" type="color" value="#ffffff" />
              <input id="tText" class="input mono" type="text" value="#ffffff" maxlength="7" />
            </div>

            <div class="previewChips" id="themePreview"></div>
          </div>

          <div class="actions">
            <button id="btnSpec" class="btn primary" type="button">Build Spec</button>
          </div>
        </section>

        <div class="hr"></div>

        <!-- STEP 2 -->
        <section class="step" id="step2">
          <div class="stepTitle">Step 2 • Spec Output</div>

          <div class="actions">
            <button id="btnCopySpec" class="btn" type="button" disabled>Copy Spec</button>
            <button id="btnDlSpec" class="btn" type="button" disabled>Download Spec</button>
            <button id="btnContinue" class="btn primary" type="button" disabled>Continue → Build Files</button>
          </div>

          <pre id="specOut" class="code" style="min-height: 240px">(Spec will appear here)</pre>
        </section>

        <div class="hr"></div>

        <!-- STEP 3 -->
        <section class="step" id="step3">
          <div class="stepTitle">Step 3 • Build Files (One at a Time)</div>

          <div class="actions">
            <button id="btnBuildHtml" class="btn primary" type="button" disabled>Build HTML</button>
            <button id="btnBuildCss" class="btn primary" type="button" disabled>Build CSS</button>
            <button id="btnBuildJs" class="btn primary" type="button" disabled>Build game.js</button>
          </div>

          <div class="fileBlock">
            <div class="fileHead">
              <div class="fileTitle">index.html</div>
              <div class="fileBtns">
                <button id="btnCopyHtml" class="btn" type="button" disabled>Copy</button>
                <button id="btnDlHtml" class="btn" type="button" disabled>Download</button>
              </div>
            </div>
            <pre id="htmlOut" class="code" style="min-height: 180px">(HTML will appear here)</pre>
          </div>

          <div class="fileBlock">
            <div class="fileHead">
              <div class="fileTitle">style.css</div>
              <div class="fileBtns">
                <button id="btnCopyCss" class="btn" type="button" disabled>Copy</button>
                <button id="btnDlCss" class="btn" type="button" disabled>Download</button>
              </div>
            </div>
            <pre id="cssOut" class="code" style="min-height: 160px">(CSS will appear here)</pre>
          </div>

          <div class="fileBlock">
            <div class="fileHead">
              <div class="fileTitle">game.js</div>
              <div class="fileBtns">
                <button id="btnCopyJs" class="btn" type="button" disabled>Copy</button>
                <button id="btnDlJs" class="btn" type="button" disabled>Download</button>
              </div>
            </div>
            <pre id="jsOut" class="code" style="min-height: 160px">(game.js will appear here)</pre>
          </div>

          <div class="hr"></div>

          <div class="actions">
            <button id="btnRefreshPreview" class="btn" type="button" disabled>Refresh Preview</button>
            <button id="btnOpenPreview" class="btn" type="button" disabled>Open Preview Tab</button>
          </div>

          <div class="field">
            <label class="label">Server echoPrompt (proves latest prompt)</label>
            <div id="echoPrompt" class="echo mono">—</div>
          </div>
        </section>

        <div class="hr"></div>

        <!-- STEP 4 -->
        <section class="step" id="step4">
          <div class="stepTitle">Step 4 • Edits (Optional)</div>

          <div class="muted small">Edits used: <strong id="editCount">0</strong> / 3</div>

          <div class="field">
            <label class="label" for="editPrompt">Edit request</label>
            <textarea id="editPrompt" class="textarea" rows="4" placeholder="Describe EXACT changes. Example: Make the HUD larger, add a flash animation when someone triggers an action, and make chat directions a glass panel on the right."></textarea>
          </div>

          <div class="field">
            <label class="label" for="editShot">Optional screenshot upload</label>
            <input id="editShot" class="input" type="file" accept="image/*" />
            <div class="hint">Helpful if something is misaligned on ChatTokGaming.com. (Optional)</div>
            <div id="shotPreviewWrap" class="shotWrap hidden">
              <img id="shotPreview" alt="Screenshot preview" />
            </div>
          </div>

          <div class="actions">
            <button id="btnEdit" class="btn primary" type="button" disabled>Apply Edit</button>
          </div>
        </section>
      </section>

      <!-- RIGHT: Preview -->
      <section class="card">
        <div class="h3">Live Preview</div>
        <div class="muted small">Preview stubs TikTokClient (no real LIVE connection). Final games connect on ChatTokGaming.com.</div>
        <div class="hr"></div>

        <div class="previewFrameWrap">
          <iframe id="previewFrame" title="Preview" class="previewFrame" src="about:blank"></iframe>
        </div>

        <div class="hr"></div>

        <div class="muted small">
          <strong>Export to ChatTokGaming:</strong> Copy the three files into the game editor (index.html, style.css, game.js).
        </div>
      </section>
    </div>
  </main>

  <script src="app.js"></script>
</body>
</html>
