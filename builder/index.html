<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ChatTokApps • Game Builder</title>
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoDot" aria-hidden="true"></div>
      <div class="brandText">
        <div class="brandTitle">ChatTokApps • Game Builder</div>
        <div class="brandSub">Spec → HTML → CSS → game.js → Edit (3×) • Live preview included</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnLoadRoutes" class="btn ghost">Load Routes</button>
      <button id="btnPing" class="btn ghost">Ping API</button>
      <button id="btnReset" class="btn ghost">Reset</button>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">

      <!-- LEFT -->
      <div class="card">
        <div class="stepHeader">
          <div class="stepTitle">Step 1 • Prompt + Theme</div>
          <div class="stepPills">
            <span class="pill" id="pillStep1">Active</span>
            <span class="pill off" id="pillStep2">Locked</span>
            <span class="pill off" id="pillStep3">Locked</span>
            <span class="pill off" id="pillStep4">Locked</span>
          </div>
        </div>

        <div class="statusBox">
          <div class="statusLine"><span class="k">API</span><span id="apiStatus">Not checked</span></div>
          <div class="statusLine"><span class="k">Status</span><span id="buildStatus">Idle</span></div>
          <div class="statusLine"><span class="k">RequestId</span><span id="reqId" class="mono">—</span></div>
        </div>

        <!-- ADVANCED API SETTINGS (hidden by default) -->
        <details class="details" id="advancedApi">
          <summary>Advanced API Settings (optional)</summary>

          <div class="detailsInner">
            <div class="muted small">
              Default API is already wired internally. Only change this if you’re troubleshooting routes/CORS.
            </div>

            <label class="toggle">
              <input id="unlockApi" type="checkbox" />
              <span>Unlock editing of API fields</span>
            </label>

            <div class="field">
              <label class="label">Render API Base URL</label>
              <input id="apiBase" class="input mono" spellcheck="false" readonly />
            </div>

            <div class="fieldRow">
              <div class="field">
                <label class="label">Ping Endpoint</label>
                <input id="pingPath" class="input mono" spellcheck="false" readonly />
              </div>
              <div class="field">
                <label class="label">Routes Endpoint</label>
                <input id="routesPath" class="input mono" spellcheck="false" readonly />
              </div>
            </div>

            <div class="fieldRow">
              <div class="field">
                <label class="label">Spec Endpoint</label>
                <input id="specPath" class="input mono" spellcheck="false" readonly />
              </div>
              <div class="field">
                <label class="label">Edit Endpoint</label>
                <input id="editPath" class="input mono" spellcheck="false" readonly />
              </div>
            </div>

            <div class="field">
              <label class="label">Build Endpoint</label>
              <input id="buildPath" class="input mono" spellcheck="false" readonly />
              <div class="hint">This builder builds one file at a time using <span class="mono">target</span>.</div>
            </div>

            <div class="block">
              <div class="blockTitle">Routes Output</div>
              <pre id="routesOut" class="pre"></pre>
            </div>
          </div>
        </details>

        <hr class="hr" />

        <h3 class="h3">Theme Colors</h3>
        <p class="muted">These are injected into the spec/build prompts so the generated game matches your brand.</p>

        <div class="colors">
          <div class="colorRow">
            <label>Primary</label>
            <input id="cPrimary" type="color" value="#ff0050" />
            <input id="tPrimary" class="input mono" value="#ff0050" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Secondary</label>
            <input id="cSecondary" type="color" value="#00f2ea" />
            <input id="tSecondary" class="input mono" value="#00f2ea" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Background</label>
            <input id="cBg" type="color" value="#050b17" />
            <input id="tBg" class="input mono" value="#050b17" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Surface</label>
            <input id="cSurface" type="color" value="#0b1632" />
            <input id="tSurface" class="input mono" value="#0b1632" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Text</label>
            <input id="cText" type="color" value="#ffffff" />
            <input id="tText" class="input mono" value="#ffffff" spellcheck="false" />
          </div>
        </div>

        <div class="previewChips">
          <div class="chip" id="chipPrimary">Primary</div>
          <div class="chip" id="chipSecondary">Secondary</div>
          <div class="chip chipSurface" id="chipSurface">Surface</div>
        </div>

        <div class="field">
          <label class="label">Game Prompt</label>
          <textarea id="prompt" class="textarea" rows="10" placeholder="Describe your TikTok LIVE interactive game in detail (host controls, chat commands, scoring, SFX, rounds, etc.)..."></textarea>
        </div>

        <div class="actions">
          <button id="btnSpec" class="btn primary">Build Spec</button>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Step 2 • Spec Output</div>
          <div class="stepRight">
            <button id="btnCopySpec" class="btn ghost" disabled>Copy Spec</button>
            <button id="btnDownloadSpec" class="btn ghost" disabled>Download</button>
            <button id="btnContinue" class="btn" disabled>Continue → Build Files</button>
          </div>
        </div>

        <pre id="specOut" class="pre"></pre>

        <div class="warn" id="warnBox" style="display:none;"></div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="stepHeader">
          <div class="stepTitle">Step 3 • Build Files (one at a time)</div>
          <div class="stepRight">
            <span class="pill off" id="pillBuildReady">Waiting</span>
          </div>
        </div>

        <div class="buildRow">
          <button id="btnBuildHtml" class="btn" disabled>Build HTML</button>
          <button id="btnBuildCss" class="btn" disabled>Build CSS</button>
          <button id="btnBuildJs" class="btn" disabled>Build game.js</button>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">index.html</div>
            <div class="fileBtns">
              <button id="btnCopyHtml" class="btn ghost" disabled>Copy</button>
              <button id="btnDownloadHtml" class="btn ghost" disabled>Download</button>
            </div>
          </div>
          <pre id="htmlOut" class="pre"></pre>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">style.css</div>
            <div class="fileBtns">
              <button id="btnCopyCss" class="btn ghost" disabled>Copy</button>
              <button id="btnDownloadCss" class="btn ghost" disabled>Download</button>
            </div>
          </div>
          <pre id="cssOut" class="pre"></pre>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">game.js</div>
            <div class="fileBtns">
              <button id="btnCopyJs" class="btn ghost" disabled>Copy</button>
              <button id="btnDownloadJs" class="btn ghost" disabled>Download</button>
            </div>
          </div>
          <pre id="jsOut" class="pre"></pre>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Live Preview</div>
          <div class="stepRight">
            <button id="btnRefreshPreview" class="btn ghost" disabled>Refresh Preview</button>
            <button id="btnOpenPreview" class="btn ghost" disabled>Open in New Tab</button>
          </div>
        </div>

        <div class="previewWrap">
          <iframe id="previewFrame" title="Game Preview"></iframe>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Step 4 • Edits (optional, 3 max)</div>
          <div class="stepRight">
            <span class="pill off" id="pillEditReady">Locked</span>
            <span class="pill">Edits: <span id="editCount">0</span>/3</span>
          </div>
        </div>

        <textarea id="editPrompt" class="textarea" rows="4" placeholder="Describe the edit (UI fixes, more style, fix TikTok logic, improve SFX, etc.)..."></textarea>

        <div class="field">
          <label class="label">Optional Screenshot (to show what’s wrong)</label>
          <input id="editScreenshot" class="input" type="file" accept="image/*" />
          <div class="hint">Optional. If provided, it’s sent to the API as a base64 data URL.</div>
        </div>

        <div class="actions">
          <button id="btnEdit" class="btn ghost" disabled>Apply Edit</button>
        </div>

        <div class="block">
          <div class="blockTitle">Prompt Echo (what the API actually used)</div>
          <pre id="echoPrompt" class="pre"></pre>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="muted">
        Hosting: <span class="mono">GitHub Pages</span> • API: <span class="mono">https://chattok-builder-api.onrender.com</span>
      </div>
    </footer>
  </main>

  <script src="./app.js"></script>
</body>
</html>
