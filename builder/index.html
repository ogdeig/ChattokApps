<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ChatTokApps • Game Builder</title>
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoDot" aria-hidden="true"></div>
      <div class="brandText">
        <div class="brandTitle">ChatTokApps • Game Builder</div>
        <div class="brandSub">Prompt → Spec → index.html + style.css + game.js (9:16 TikTok Live games)</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnPing" class="btn ghost">Ping API</button>
      <button id="btnReset" class="btn ghost">Reset UI</button>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <!-- LEFT PANEL -->
      <div class="card">
        <h2>Builder Settings</h2>

        <div class="field">
          <label class="label">Render API Base URL</label>
          <input id="apiBase" class="input mono" spellcheck="false" />
          <div class="hint">
            Default is your Render API. You can change it temporarily for testing.
          </div>
        </div>

        <div class="fieldRow">
          <div class="field">
            <label class="label">Spec Endpoint</label>
            <input id="specPath" class="input mono" spellcheck="false" />
            <div class="hint">Example: <span class="mono">/api/spec</span> or <span class="mono">/api/plan</span></div>
          </div>
          <div class="field">
            <label class="label">Build Endpoint</label>
            <input id="buildPath" class="input mono" spellcheck="false" />
            <div class="hint">Example: <span class="mono">/api/build</span></div>
          </div>
        </div>

        <div class="fieldRow">
          <div class="field">
            <label class="label">Edit Endpoint</label>
            <input id="editPath" class="input mono" spellcheck="false" />
            <div class="hint">Example: <span class="mono">/api/edit</span></div>
          </div>
          <div class="field">
            <label class="label">Ping Endpoint</label>
            <input id="pingPath" class="input mono" spellcheck="false" />
            <div class="hint">Example: <span class="mono">/api/ping</span></div>
          </div>
        </div>

        <hr class="hr" />

        <h2>Theme Colors</h2>
        <p class="muted">
          These values are passed into the spec/build requests so the AI can generate a consistent professional style.
        </p>

        <div class="colors">
          <div class="colorRow">
            <label>Primary</label>
            <input id="cPrimary" type="color" value="#ff0050" />
            <input id="tPrimary" class="input mono" value="#ff0050" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Secondary</label>
            <input id="cSecondary" type="color" value="#00f2ea" />
            <input id="tSecondary" class="input mono" value="#00f2ea" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Background</label>
            <input id="cBg" type="color" value="#050b17" />
            <input id="tBg" class="input mono" value="#050b17" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Surface</label>
            <input id="cSurface" type="color" value="#0b1632" />
            <input id="tSurface" class="input mono" value="#0b1632" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Text</label>
            <input id="cText" type="color" value="#ffffff" />
            <input id="tText" class="input mono" value="#ffffff" spellcheck="false" />
          </div>
        </div>

        <div class="preview">
          <div class="chip" id="chipPrimary">Primary</div>
          <div class="chip" id="chipSecondary">Secondary</div>
          <div class="chip chipSurface" id="chipSurface">Surface</div>
        </div>

        <hr class="hr" />

        <h2>Prompt</h2>
        <p class="muted">
          Write a detailed game idea. The builder always generates a structured spec first, then full game files.
        </p>

        <textarea id="prompt" class="textarea" rows="11" placeholder="Describe your TikTok Live interactive game idea..."></textarea>

        <div class="toggles">
          <label class="toggle">
            <input id="useCache" type="checkbox" checked />
            <span>Allow server-side cache (cheaper)</span>
          </label>
          <label class="toggle">
            <input id="forceFresh" type="checkbox" />
            <span>Force fresh (ignore cache)</span>
          </label>
        </div>

        <div class="actions">
          <button id="btnSpec" class="btn">Build Spec</button>
          <button id="btnBuild" class="btn primary">Build Game Files</button>
        </div>

        <div class="statusBox">
          <div class="statusLine"><span class="k">RequestId</span><span id="reqId" class="mono">—</span></div>
          <div class="statusLine"><span class="k">API</span><span id="apiStatus">Not checked</span></div>
          <div class="statusLine"><span class="k">Build</span><span id="buildStatus">Idle</span></div>
        </div>

        <hr class="hr" />

        <h2>Edit (up to 3)</h2>
        <p class="muted">
          After a build, request targeted edits. Optional: attach a screenshot (UI issue, console error, etc).
        </p>

        <textarea id="editPrompt" class="textarea" rows="4" placeholder="Example: Make the HUD cleaner, add more juice to explosions, fix scoreboard spacing..."></textarea>

        <div class="field">
          <label class="label">Attach screenshot (optional)</label>
          <input id="editImage" class="input" type="file" accept="image/*" />
          <div class="hint">This sends a small base64 image to your API (limit ~900KB).</div>
        </div>

        <div class="actions">
          <button id="btnEdit" class="btn ghost" disabled>Apply Edit</button>
          <div class="pill">Edits used: <span id="editCount">0</span>/3</div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="card">
        <h2>Outputs</h2>

        <div class="block">
          <div class="blockTitle">Prompt Echo (what the API actually used)</div>
          <pre id="echoPrompt" class="pre"></pre>
        </div>

        <div class="block">
          <div class="blockTitle">Spec JSON</div>
          <pre id="specOut" class="pre"></pre>
        </div>

        <div class="block">
          <div class="blockTitle">Built Files (JSON)</div>
          <div class="dlRow">
            <button id="dlHtml" class="btn ghost">Download index.html</button>
            <button id="dlCss" class="btn ghost">Download style.css</button>
            <button id="dlJs" class="btn ghost">Download game.js</button>
            <button id="dlAll" class="btn ghost">Download All (3)</button>
          </div>
          <pre id="filesOut" class="pre"></pre>
        </div>

        <div class="block">
          <div class="blockTitle">Notes</div>
          <div class="note">
            If you see 404/500 errors:
            <ul>
              <li>Hit <b>Ping API</b> to confirm connectivity.</li>
              <li>Change the endpoint paths (spec/build/edit) to match your Render API routes.</li>
              <li>Use <b>Prompt Echo</b> to prove the latest prompt is being used (no stale prompts).</li>
            </ul>
          </div>
        </div>

      </div>
    </section>

    <footer class="footer">
      <div class="muted">
        Tool path: <span class="mono">/builder/</span> • API default: <span class="mono">https://chattok-builder-api.onrender.com</span>
      </div>
    </footer>
  </main>

  <script src="./app.js"></script>
</body>
</html>
