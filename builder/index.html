<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ChatTokApps • Game Builder</title>
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoDot" aria-hidden="true"></div>
      <div class="brandText">
        <div class="brandTitle">ChatTokApps • Game Builder</div>
        <div class="brandSub">Spec → HTML → CSS → game.js → Edit • Live preview included</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnPing" class="btn ghost">Ping API</button>
      <button id="btnReset" class="btn ghost">Reset</button>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="stepHeader">
          <div class="stepTitle">Step 1 • Theme + Prompt</div>
          <div class="stepPills">
            <span class="pill" id="pillStep1">Active</span>
            <span class="pill off" id="pillStep2">Locked</span>
            <span class="pill off" id="pillStep3">Locked</span>
            <span class="pill off" id="pillStep4">Locked</span>
          </div>
        </div>

        <div class="fieldRow">
          <div class="field">
            <label class="label">Render API Base URL</label>
            <input id="apiBase" class="input mono" spellcheck="false" />
            <div class="hint">Default: https://chattok-builder-api.onrender.com</div>
          </div>

          <div class="field">
            <label class="label">Spec Endpoint</label>
            <input id="specPath" class="input mono" spellcheck="false" />
            <div class="hint">Use <span class="mono">/api/plan</span> (recommended) or <span class="mono">/api/spec</span></div>
          </div>
        </div>

        <div class="fieldRow">
          <div class="field">
            <label class="label">Build Endpoint</label>
            <input id="buildPath" class="input mono" spellcheck="false" />
            <div class="hint">Usually <span class="mono">/api/build</span></div>
          </div>
          <div class="field">
            <label class="label">Edit Endpoint</label>
            <input id="editPath" class="input mono" spellcheck="false" />
            <div class="hint">Usually <span class="mono">/api/edit</span></div>
          </div>
        </div>

        <div class="field">
          <label class="label">Ping Endpoint</label>
          <input id="pingPath" class="input mono" spellcheck="false" />
          <div class="hint">Usually <span class="mono">/api/ping</span></div>
        </div>

        <hr class="hr" />

        <h3 class="h3">Theme Colors</h3>
        <p class="muted">These are injected into the spec/build prompts so the generated game matches your brand.</p>

        <div class="colors">
          <div class="colorRow">
            <label>Primary</label>
            <input id="cPrimary" type="color" value="#ff0050" />
            <input id="tPrimary" class="input mono" value="#ff0050" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Secondary</label>
            <input id="cSecondary" type="color" value="#00f2ea" />
            <input id="tSecondary" class="input mono" value="#00f2ea" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Background</label>
            <input id="cBg" type="color" value="#050b17" />
            <input id="tBg" class="input mono" value="#050b17" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Surface</label>
            <input id="cSurface" type="color" value="#0b1632" />
            <input id="tSurface" class="input mono" value="#0b1632" spellcheck="false" />
          </div>
          <div class="colorRow">
            <label>Text</label>
            <input id="cText" type="color" value="#ffffff" />
            <input id="tText" class="input mono" value="#ffffff" spellcheck="false" />
          </div>
        </div>

        <div class="previewChips">
          <div class="chip" id="chipPrimary">Primary</div>
          <div class="chip" id="chipSecondary">Secondary</div>
          <div class="chip chipSurface" id="chipSurface">Surface</div>
        </div>

        <div class="field">
          <label class="label">Game Prompt</label>
          <textarea id="prompt" class="textarea" rows="10" placeholder="Describe your TikTok Live interactive game in detail..."></textarea>
        </div>

        <div class="toggles">
          <label class="toggle">
            <input id="useCache" type="checkbox" checked />
            <span>Allow cache (cheaper)</span>
          </label>
          <label class="toggle">
            <input id="forceFresh" type="checkbox" />
            <span>Force fresh (ignore cache)</span>
          </label>
        </div>

        <div class="actions">
          <button id="btnSpec" class="btn primary">Build Spec</button>
        </div>

        <div class="statusBox">
          <div class="statusLine"><span class="k">RequestId</span><span id="reqId" class="mono">—</span></div>
          <div class="statusLine"><span class="k">API</span><span id="apiStatus">Not checked</span></div>
          <div class="statusLine"><span class="k">Status</span><span id="buildStatus">Idle</span></div>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Step 2 • Confirm Spec</div>
          <div class="stepRight">
            <button id="btnCopySpec" class="btn ghost" disabled>Copy Spec</button>
            <button id="btnContinue" class="btn" disabled>Continue →</button>
          </div>
        </div>
        <pre id="specOut" class="pre"></pre>

        <div class="warn" id="warnBox" style="display:none;"></div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="stepHeader">
          <div class="stepTitle">Step 3 • Build Files (one at a time)</div>
          <div class="stepRight">
            <span class="pill off" id="pillBuildReady">Waiting</span>
          </div>
        </div>

        <div class="buildRow">
          <button id="btnBuildHtml" class="btn" disabled>Build HTML</button>
          <button id="btnBuildCss" class="btn" disabled>Build CSS</button>
          <button id="btnBuildJs" class="btn" disabled>Build game.js</button>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">index.html</div>
            <div class="fileBtns">
              <button id="btnCopyHtml" class="btn ghost" disabled>Copy</button>
            </div>
          </div>
          <pre id="htmlOut" class="pre"></pre>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">style.css</div>
            <div class="fileBtns">
              <button id="btnCopyCss" class="btn ghost" disabled>Copy</button>
            </div>
          </div>
          <pre id="cssOut" class="pre"></pre>
        </div>

        <div class="fileCard">
          <div class="fileHead">
            <div class="fileTitle">game.js</div>
            <div class="fileBtns">
              <button id="btnCopyJs" class="btn ghost" disabled>Copy</button>
            </div>
          </div>
          <pre id="jsOut" class="pre"></pre>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Live Preview</div>
          <div class="stepRight">
            <button id="btnRefreshPreview" class="btn ghost" disabled>Refresh Preview</button>
            <button id="btnOpenPreview" class="btn ghost" disabled>Open in New Tab</button>
          </div>
        </div>

        <div class="previewWrap">
          <iframe id="previewFrame" title="Game Preview"></iframe>
        </div>

        <hr class="hr" />

        <div class="stepHeader">
          <div class="stepTitle">Step 4 • Edit (optional, 3 max)</div>
          <div class="stepRight">
            <span class="pill off" id="pillEditReady">Locked</span>
            <span class="pill">Edits: <span id="editCount">0</span>/3</span>
          </div>
        </div>

        <textarea id="editPrompt" class="textarea" rows="4" placeholder="Describe the edit you want (UI fixes, more style, fix TikTok logic, etc)..."></textarea>

        <div class="actions">
          <button id="btnEdit" class="btn ghost" disabled>Apply Edit</button>
        </div>

        <div class="block">
          <div class="blockTitle">Prompt Echo (what the API actually used)</div>
          <pre id="echoPrompt" class="pre"></pre>
        </div>

      </div>
    </section>

    <footer class="footer">
      <div class="muted">
        Hosting: <span class="mono">GitHub Pages</span> • Tool: <span class="mono">/builder/</span> • API: <span class="mono">chattok-builder-api.onrender.com</span>
      </div>
    </footer>
  </main>

  <script src="./app.js"></script>
</body>
</html>
